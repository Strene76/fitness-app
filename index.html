if (workouts.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-bolt text-3xl mb-3 opacity-50"></i<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üí™ Pompes & Gainage</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-50">
    <div class="max-w-md mx-auto bg-gray-50 h-screen flex flex-col">
        <!-- Header -->
        <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4">
            <h1 class="text-xl font-bold text-center">üí™ Pompes & Gainage</h1>
            <p class="text-center text-blue-100 mt-1 text-sm">Votre coach personnel</p>
        </div>

        <!-- Navigation -->
        <div class="bg-white shadow-sm border-b">
            <div class="flex">
                <button onclick="setActiveTab('workout')" id="tab-workout" class="flex-1 py-3 px-2 text-center font-medium text-blue-600 border-b-2 border-blue-600 bg-blue-50">
                    <i class="fas fa-stopwatch text-sm mb-1 block"></i>
                    <span class="text-xs">Entra√Ænement</span>
                </button>
                <button onclick="setActiveTab('history')" id="tab-history" class="flex-1 py-3 px-2 text-center font-medium text-gray-500 hover:text-gray-700">
                    <i class="fas fa-calendar-alt text-sm mb-1 block"></i>
                    <span class="text-xs">Historique</span>
                </button>
                <button onclick="setActiveTab('stats')" id="tab-stats" class="flex-1 py-3 px-2 text-center font-medium text-gray-500 hover:text-gray-700">
                    <i class="fas fa-chart-line text-sm mb-1 block"></i>
                    <span class="text-xs">Stats</span>
                </button>
            </div>
        </div>

        <!-- Contenu -->
        <div class="flex-1 overflow-y-auto">
            <!-- Onglet Entra√Ænement -->
            <div id="workout-tab" class="tab-content p-3 space-y-3">
                <!-- Stats du jour -->
                <div class="bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg p-3 text-white">
                    <h2 class="text-sm font-bold mb-2">Aujourd'hui</h2>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <div id="today-pushups" class="text-lg font-bold">0</div>
                            <div class="text-xs opacity-90">Pompes (/<span id="goal-pushups">50</span>)</div>
                            <div class="w-full bg-white bg-opacity-30 rounded-full h-1.5 mt-1">
                                <div id="progress-pushups" class="bg-white h-1.5 rounded-full transition-all duration-500" style="width: 0%"></div>
                            </div>
                        </div>
                        <div>
                            <div id="today-plank" class="text-lg font-bold">0:00</div>
                            <div class="text-xs opacity-90">Gainage (/<span id="goal-plank">2:00</span>)</div>
                            <div class="w-full bg-white bg-opacity-30 rounded-full h-1.5 mt-1">
                                <div id="progress-plank" class="bg-white h-1.5 rounded-full transition-all duration-500" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Compteur Pompes -->
                <div class="bg-white rounded-lg p-4 shadow">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-lg font-bold text-gray-800">üí™ Pompes</h3>
                        <div class="bg-blue-100 px-2 py-1 rounded-full">
                            <span id="pushup-badge" class="text-blue-600 font-semibold text-sm">0</span>
                        </div>
                    </div>
                    
                    <div class="text-center">
                        <div id="pushup-display" class="text-4xl font-bold text-blue-600 mb-3">0</div>
                        <div class="flex gap-2 justify-center">
                            <button onclick="decrementPushups()" id="pushup-minus" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-semibold transition-colors text-sm" disabled>
                                -1
                            </button>
                            <button onclick="incrementPushups()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg font-semibold transition-colors">
                                +1
                            </button>
                            <button onclick="addPushups(5)" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold transition-colors text-sm">
                                +5
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Chrono Gainage -->
                <div class="bg-white rounded-lg p-4 shadow">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-lg font-bold text-gray-800">‚è±Ô∏è Gainage</h3>
                        <div id="plank-status" class="px-2 py-1 rounded-full bg-gray-100">
                            <span class="font-semibold text-gray-600 text-xs">ARR√äT√â</span>
                        </div>
                    </div>
                    
                    <div class="text-center">
                        <div id="plank-display" class="text-4xl font-bold mb-3 text-gray-600">0:00</div>
                        <div class="flex gap-2 justify-center">
                            <button onclick="resetPlank()" class="bg-gray-500 hover:bg-gray-600 text-white p-2 rounded-lg transition-colors" title="Reset">
                                <i class="fas fa-redo text-sm"></i>
                            </button>
                            <button onclick="togglePlank()" id="plank-toggle" class="px-6 py-2 rounded-lg font-semibold flex items-center gap-2 transition-colors bg-green-500 hover:bg-green-600 text-white">
                                <i class="fas fa-play text-sm"></i>
                                START
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Bouton sauvegarder -->
                <button onclick="saveWorkout()" id="save-btn" class="w-full bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white py-3 rounded-lg font-bold shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                    üíæ SAUVEGARDER LA S√âANCE
                </button>
            </div>

            <!-- Onglet Historique -->
            <div id="history-tab" class="tab-content hidden p-3">
                <h2 class="text-xl font-bold text-gray-800 mb-3">üìà Historique</h2>
                <div id="workouts-list" class="space-y-2">
                    <!-- Les s√©ances seront ajout√©es ici dynamiquement -->
                </div>
            </div>

            <!-- Onglet Stats -->
            <div id="stats-tab" class="tab-content hidden p-3 space-y-4">
                <h2 class="text-xl font-bold text-gray-800 mb-3">üìä Statistiques</h2>
                
                <!-- Stats g√©n√©rales -->
                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-gradient-to-br from-blue-500 to-blue-600 p-3 rounded-lg text-white">
                        <div id="total-pushups" class="text-xl font-bold">0</div>
                        <div class="text-xs opacity-90">Total pompes</div>
                    </div>
                    <div class="bg-gradient-to-br from-green-500 to-green-600 p-3 rounded-lg text-white">
                        <div id="total-plank" class="text-xl font-bold">0:00</div>
                        <div class="text-xs opacity-90">Total gainage</div>
                    </div>
                    <div class="bg-gradient-to-br from-purple-500 to-purple-600 p-3 rounded-lg text-white">
                        <div id="total-sessions" class="text-xl font-bold">0</div>
                        <div class="text-xs opacity-90">S√©ances</div>
                    </div>
                    <div class="bg-gradient-to-br from-pink-500 to-pink-600 p-3 rounded-lg text-white">
                        <div id="avg-pushups" class="text-xl font-bold">0</div>
                        <div class="text-xs opacity-90">Moy. pompes</div>
                    </div>
                </div>

                <!-- Objectifs -->
                <div class="bg-white p-4 rounded-lg shadow">
                    <h3 class="font-bold text-lg mb-3">üéØ Objectifs & Rappels</h3>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Pompes par jour: <span id="pushup-goal-value">50</span>
                            </label>
                            <input type="range" id="pushup-goal-slider" min="10" max="200" step="5" value="50" 
                                   class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Gainage par jour: <span id="plank-goal-value">2:00</span>
                            </label>
                            <input type="range" id="plank-goal-slider" min="30" max="600" step="15" value="120"
                                   class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        </div>
                        
                        <!-- Rappels -->
                        <div class="border-t pt-3 mt-4">
                            <div class="flex items-center justify-between mb-2">
                                <label class="text-sm font-medium text-gray-700">Rappels quotidiens</label>
                                <span id="notification-status" class="text-xs text-gray-500">D√©sactiv√©s</span>
                            </div>
                            <button onclick="toggleNotifications()" id="notification-toggle" 
                                    class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg text-sm font-medium transition-colors">
                                üîî Activer les rappels
                            </button>
                            
                            <div id="reminder-time" class="mt-3 hidden">
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    Heure du rappel: <span id="reminder-time-value">18:00</span>
                                </label>
                                <input type="time" id="reminder-time-input" value="18:00" 
                                       class="w-full p-2 border border-gray-300 rounded-lg text-sm">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading overlay -->
    <div id="loading" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
        <div class="bg-white p-6 rounded-xl text-center">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"></div>
            <p>Connexion √† Firebase...</p>
        </div>
    </div>

    <!-- Notification Permission Modal -->
    <div id="notification-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl p-6 max-w-sm mx-auto text-center">
            <div class="text-4xl mb-4">üîî</div>
            <h3 class="text-lg font-bold mb-2">Activer les rappels ?</h3>
            <p class="text-gray-600 text-sm mb-6">Recevez des notifications pour ne pas oublier votre entra√Ænement quotidien !</p>
            <div class="flex gap-3">
                <button onclick="declineNotifications()" class="flex-1 bg-gray-200 text-gray-700 py-2 px-4 rounded-lg font-medium">
                    Plus tard
                </button>
                <button onclick="enableNotifications()" class="flex-1 bg-blue-500 text-white py-2 px-4 rounded-lg font-medium">
                    Activer
                </button>
            </div>
        </div>
    </div>

    <!-- Motivation Banner -->
    <div id="motivation-banner" class="hidden fixed top-20 left-4 right-4 bg-gradient-to-r from-orange-400 to-red-500 text-white p-4 rounded-lg shadow-lg z-40 animate-bounce">
        <div class="flex items-center justify-between">
            <div>
                <div class="font-bold">üî• Motivation du jour !</div>
                <div class="text-sm opacity-90" id="motivation-text">Il est temps de bouger !</div>
            </div>
            <button onclick="hideMotivatonBanner()" class="text-white hover:bg-white hover:bg-opacity-20 p-2 rounded-full">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Configuration Firebase - REMPLACEZ avec vos propres cl√©s
        const firebaseConfig = {
            apiKey: "AIzaSyD11MBNfS-eI4B4UR7b6gPtHo7zfN6CgME",
            authDomain: "fitness-app-b437f.firebaseapp.com",
            projectId: "fitness-app-b437f",
            storageBucket: "fitness-app-b437f.firebasestorage.app",
            messagingSenderId: "280277740696",
            appId: "1:280277740696:web:d3cedc8349cc71ee3174ed"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Variables globales
        let activeTab = 'workout';
        let pushupCount = 0;
        let plankTime = 0;
        let isPlankActive = false;
        let plankInterval = null;
        let workouts = [];
        let dailyGoal = { pushups: 50, plank: 120 };
        let notificationsEnabled = false;
        let reminderTime = '18:00';
        let lastWorkoutDate = null;

        // Messages de motivation
        const motivationMessages = [
            "üí™ Il est temps de faire vos pompes !",
            "‚è∞ N'oubliez pas votre gainage quotidien !",
            "üî• Votre corps vous remerciera plus tard !",
            "üéØ Atteignons vos objectifs ensemble !",
            "üíØ Chaque pompe compte, c'est parti !",
            "‚ö° 5 minutes pour √™tre plus fort !",
            "üèÜ Les champions s'entra√Ænent tous les jours !",
            "üöÄ D√©passez-vous, vous en √™tes capable !"
        ];

        // Fonction pour formater le temps
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // Fonction pour obtenir la date du jour
        function getTodayDate() {
            return new Date().toISOString().split('T')[0];
        }

        // Fonction pour obtenir les stats du jour
        function getTodayStats() {
            const today = getTodayDate();
            const todayWorkouts = workouts.filter(w => w.date === today);
            const totalPushups = todayWorkouts.reduce((sum, w) => sum + w.pushups, 0) + pushupCount;
            const totalPlank = todayWorkouts.reduce((sum, w) => sum + w.plankTime, 0) + plankTime;
            return { totalPushups, totalPlank };
        }

        // Gestion des notifications
        async function requestNotificationPermission() {
            if ('Notification' in window) {
                const permission = await Notification.requestPermission();
                return permission === 'granted';
            }
            return false;
        }

        function scheduleNotification() {
            if (!notificationsEnabled) return;
            
            const now = new Date();
            const today = new Date();
            const [hours, minutes] = reminderTime.split(':');
            today.setHours(parseInt(hours), parseInt(minutes), 0, 0);
            
            // Si l'heure est pass√©e, programmer pour demain
            if (today <= now) {
                today.setDate(today.getDate() + 1);
            }
            
            const timeUntilNotification = today.getTime() - now.getTime();
            
            setTimeout(() => {
                checkDailyGoalsAndNotify();
                scheduleNotification(); // Programmer pour le jour suivant
            }, timeUntilNotification);
        }

        function checkDailyGoalsAndNotify() {
            const { totalPushups, totalPlank } = getTodayStats();
            const pushupsCompleted = totalPushups >= dailyGoal.pushups;
            const plankCompleted = totalPlank >= dailyGoal.plank;
            
            if (!pushupsCompleted || !plankCompleted) {
                const randomMessage = motivationMessages[Math.floor(Math.random() * motivationMessages.length)];
                
                if ('Notification' in window && Notification.permission === 'granted') {
                    new Notification('üí™ Pompes & Gainage', {
                        body: randomMessage,
                        icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">üí™</text></svg>',
                        badge: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">üí™</text></svg>',
                        tag: 'fitness-reminder',
                        requireInteraction: true
                    });
                }
                
                // Afficher aussi le banner de motivation
                showMotivationBanner(randomMessage);
            }
        }

        function showMotivationBanner(message) {
            document.getElementById('motivation-text').textContent = message;
            document.getElementById('motivation-banner').classList.remove('hidden');
            
            // Auto-hide apr√®s 10 secondes
            setTimeout(() => {
                document.getElementById('motivation-banner').classList.add('hidden');
            }, 10000);
        }

        window.hideMotivatonBanner = function() {
            document.getElementById('motivation-banner').classList.add('hidden');
        };

        window.enableNotifications = async function() {
            const granted = await requestNotificationPermission();
            if (granted) {
                notificationsEnabled = true;
                updateNotificationUI();
                scheduleNotification();
                localStorage.setItem('fitness-notifications', JSON.stringify({
                    enabled: true,
                    reminderTime: reminderTime
                }));
                document.getElementById('notification-modal').classList.add('hidden');
                alert('üéâ Rappels activ√©s ! Vous recevrez une notification quotidienne.');
            } else {
                alert('‚ùå Permission refus√©e. Vous pouvez l\'activer dans les param√®tres de votre navigateur.');
            }
        };

        window.declineNotifications = function() {
            document.getElementById('notification-modal').classList.add('hidden');
            localStorage.setItem('fitness-notifications-declined', 'true');
        };

        window.toggleNotifications = async function() {
            if (!notificationsEnabled) {
                const granted = await requestNotificationPermission();
                if (granted) {
                    notificationsEnabled = true;
                    scheduleNotification();
                } else {
                    alert('‚ùå Permission refus√©e. Activez les notifications dans les param√®tres de votre navigateur.');
                    return;
                }
            } else {
                notificationsEnabled = false;
            }
            
            updateNotificationUI();
            localStorage.setItem('fitness-notifications', JSON.stringify({
                enabled: notificationsEnabled,
                reminderTime: reminderTime
            }));
        };

        function updateNotificationUI() {
            const statusEl = document.getElementById('notification-status');
            const toggleBtn = document.getElementById('notification-toggle');
            const reminderDiv = document.getElementById('reminder-time');
            
            if (notificationsEnabled) {
                statusEl.textContent = '‚úÖ Activ√©s';
                statusEl.className = 'text-xs text-green-600';
                toggleBtn.textContent = 'üîï D√©sactiver les rappels';
                toggleBtn.className = 'w-full bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded-lg text-sm font-medium transition-colors';
                reminderDiv.classList.remove('hidden');
            } else {
                statusEl.textContent = '‚ùå D√©sactiv√©s';
                statusEl.className = 'text-xs text-gray-500';
                toggleBtn.textContent = 'üîî Activer les rappels';
                toggleBtn.className = 'w-full bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg text-sm font-medium transition-colors';
                reminderDiv.classList.add('hidden');
            }
        }

        // V√©rification quotidienne automatique
        function checkDailyActivity() {
            const today = getTodayDate();
            const hasWorkedOutToday = workouts.some(w => w.date === today) || pushupCount > 0 || plankTime > 0;
            
            if (!hasWorkedOutToday && notificationsEnabled) {
                const now = new Date();
                const currentHour = now.getHours();
                
                // V√©rifier plusieurs fois dans la journ√©e
                if (currentHour === 12 || currentHour === 16 || currentHour === 20) {
                    const randomMessage = motivationMessages[Math.floor(Math.random() * motivationMessages.length)];
                    showMotivationBanner(randomMessage);
                }
            }
        }

        // Mise √† jour de l'affichage
        function updateDisplay() {
            // Mise √† jour du compteur de pompes
            document.getElementById('pushup-display').textContent = pushupCount;
            document.getElementById('pushup-badge').textContent = pushupCount;
            document.getElementById('pushup-minus').disabled = pushupCount === 0;

            // Mise √† jour du chrono gainage
            document.getElementById('plank-display').textContent = formatTime(plankTime);
            document.getElementById('plank-display').className = `text-6xl font-bold mb-6 ${isPlankActive ? 'text-green-600' : 'text-gray-600'}`;

            // Mise √† jour du statut du gainage
            const statusDiv = document.getElementById('plank-status');
            if (isPlankActive) {
                statusDiv.className = 'px-3 py-1 rounded-full bg-green-100';
                statusDiv.innerHTML = '<span class="font-semibold text-green-600">EN COURS</span>';
            } else {
                statusDiv.className = 'px-3 py-1 rounded-full bg-gray-100';
                statusDiv.innerHTML = '<span class="font-semibold text-gray-600">ARR√äT√â</span>';
            }

            // Mise √† jour du bouton plank
            const toggleBtn = document.getElementById('plank-toggle');
            if (isPlankActive) {
                toggleBtn.className = 'px-8 py-3 rounded-lg font-semibold text-lg flex items-center gap-2 transition-colors bg-red-500 hover:bg-red-600 text-white';
                toggleBtn.innerHTML = '<i class="fas fa-pause"></i> PAUSE';
            } else {
                toggleBtn.className = 'px-8 py-3 rounded-lg font-semibold text-lg flex items-center gap-2 transition-colors bg-green-500 hover:bg-green-600 text-white';
                toggleBtn.innerHTML = '<i class="fas fa-play"></i> START';
            }

            // Mise √† jour des stats du jour
            const { totalPushups, totalPlank } = getTodayStats();
            document.getElementById('today-pushups').textContent = totalPushups;
            document.getElementById('today-plank').textContent = formatTime(totalPlank);

            // Mise √† jour des barres de progression
            const pushupsProgress = Math.min(100, (totalPushups / dailyGoal.pushups) * 100);
            const plankProgress = Math.min(100, (totalPlank / dailyGoal.plank) * 100);
            document.getElementById('progress-pushups').style.width = `${pushupsProgress}%`;
            document.getElementById('progress-plank').style.width = `${plankProgress}%`;

            // Mise √† jour du bouton sauvegarder
            document.getElementById('save-btn').disabled = pushupCount === 0 && plankTime === 0;
        }

        // Fonction pour g√©rer les pompes
        window.incrementPushups = function() {
            pushupCount++;
            updateDisplay();
        };

        window.decrementPushups = function() {
            if (pushupCount > 0) {
                pushupCount--;
                updateDisplay();
            }
        };

        window.addPushups = function(amount) {
            pushupCount += amount;
            updateDisplay();
        };

        // Fonction pour g√©rer le gainage
        window.togglePlank = function() {
            if (isPlankActive) {
                clearInterval(plankInterval);
                plankInterval = null;
                isPlankActive = false;
            } else {
                plankInterval = setInterval(() => {
                    plankTime++;
                    updateDisplay();
                }, 1000);
                isPlankActive = true;
            }
            updateDisplay();
        };

        window.resetPlank = function() {
            plankTime = 0;
            isPlankActive = false;
            if (plankInterval) {
                clearInterval(plankInterval);
                plankInterval = null;
            }
            updateDisplay();
        };

        // Fonction pour sauvegarder une s√©ance
        window.saveWorkout = async function() {
            if (pushupCount === 0 && plankTime === 0) return;

            document.getElementById('loading').classList.remove('hidden');
            
            try {
                const newWorkout = {
                    date: getTodayDate(),
                    pushups: pushupCount,
                    plankTime: plankTime,
                    timestamp: new Date().toLocaleString('fr-FR'),
                    createdAt: new Date()
                };

                await addDoc(collection(db, 'workouts'), newWorkout);
                
                // Reset des valeurs
                pushupCount = 0;
                plankTime = 0;
                isPlankActive = false;
                
                if (plankInterval) {
                    clearInterval(plankInterval);
                    plankInterval = null;
                }
                
                await loadWorkouts();
                updateDisplay();
                updateStats();
                
                alert('S√©ance sauvegard√©e ! üéâ');
            } catch (error) {
                console.error('Erreur lors de la sauvegarde:', error);
                alert('Erreur lors de la sauvegarde. V√©rifiez votre configuration Firebase.');
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        };

        // Fonction pour charger les s√©ances
        async function loadWorkouts() {
            try {
                const q = query(collection(db, 'workouts'), orderBy('createdAt', 'desc'));
                const querySnapshot = await getDocs(q);
                workouts = [];
                querySnapshot.forEach((doc) => {
                    workouts.push({ id: doc.id, ...doc.data() });
                });
                updateHistoryDisplay();
            } catch (error) {
                console.error('Erreur lors du chargement:', error);
                // Fallback sur le localStorage si Firebase √©choue
                const saved = localStorage.getItem('fitness-workouts');
                workouts = saved ? JSON.parse(saved) : [];
                updateHistoryDisplay();
            }
        }

        // Fonction pour supprimer une s√©ance
        window.deleteWorkout = async function(workoutId) {
            if (!confirm('√ätes-vous s√ªr de vouloir supprimer cette s√©ance ?')) return;
            
            document.getElementById('loading').classList.remove('hidden');
            
            try {
                await deleteDoc(doc(db, 'workouts', workoutId));
                await loadWorkouts();
                updateStats();
            } catch (error) {
                console.error('Erreur lors de la suppression:', error);
                alert('Erreur lors de la suppression');
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        };

        // Fonction pour mettre √† jour l'affichage de l'historique
        function updateHistoryDisplay() {
            const container = document.getElementById('workouts-list');
            
            if (workouts.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12 text-gray-500">
                        <i class="fas fa-bolt text-4xl mb-4 opacity-50"></i>
                        <p class="text-lg mb-2">Aucune s√©ance enregistr√©e</p>
                        <p class="text-sm">Commencez votre premier entra√Ænement !</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = workouts.slice(0, 10).map(workout => `
                <div class="bg-white p-3 rounded-lg shadow border">
                    <div class="flex justify-between items-start mb-2">
                        <div class="text-xs text-gray-500">${workout.timestamp}</div>
                        <button onclick="deleteWorkout('${workout.id}')" 
                                class="text-red-500 hover:text-red-700 hover:bg-red-50 p-1 rounded-full transition-colors"
                                title="Supprimer cette s√©ance">
                            <i class="fas fa-trash text-xs"></i>
                        </button>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="flex items-center gap-2">
                            <div class="w-2 h-2 bg-blue-500 rounded-full"></div>
                            <span class="font-semibold text-sm">${workout.pushups} pompes</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                            <span class="font-semibold text-sm">${formatTime(workout.plankTime)} gainage</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Fonction pour mettre √† jour les statistiques
        function updateStats() {
            const totalPushups = workouts.reduce((sum, w) => sum + w.pushups, 0);
            const totalPlankTime = workouts.reduce((sum, w) => sum + w.plankTime, 0);
            const avgPushups = workouts.length > 0 ? Math.round(totalPushups / workouts.length) : 0;

            document.getElementById('total-pushups').textContent = totalPushups;
            document.getElementById('total-plank').textContent = formatTime(totalPlankTime);
            document.getElementById('total-sessions').textContent = workouts.length;
            document.getElementById('avg-pushups').textContent = avgPushups;
        }

        // Gestion des onglets
        window.setActiveTab = function(tab) {
            activeTab = tab;
            
            // Mise √† jour des boutons
            document.querySelectorAll('[id^="tab-"]').forEach(btn => {
                btn.className = 'flex-1 py-3 px-2 text-center font-medium text-gray-500 hover:text-gray-700';
            });
            document.getElementById(`tab-${tab}`).className = 'flex-1 py-3 px-2 text-center font-medium text-blue-600 border-b-2 border-blue-600 bg-blue-50';
            
            // Mise √† jour du contenu
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(`${tab}-tab`).classList.remove('hidden');

            if (tab === 'history') {
                updateHistoryDisplay();
            } else if (tab === 'stats') {
                updateStats();
            }
        };

        // Gestion des objectifs
        document.getElementById('pushup-goal-slider').addEventListener('input', function(e) {
            dailyGoal.pushups = parseInt(e.target.value);
            document.getElementById('pushup-goal-value').textContent = dailyGoal.pushups;
            document.getElementById('goal-pushups').textContent = dailyGoal.pushups;
            updateDisplay();
            localStorage.setItem('fitness-goals', JSON.stringify(dailyGoal));
        });

        document.getElementById('plank-goal-slider').addEventListener('input', function(e) {
            dailyGoal.plank = parseInt(e.target.value);
            document.getElementById('plank-goal-value').textContent = formatTime(dailyGoal.plank);
            document.getElementById('goal-plank').textContent = formatTime(dailyGoal.plank);
            updateDisplay();
            localStorage.setItem('fitness-goals', JSON.stringify(dailyGoal));
        });

        // Gestion de l'heure de rappel
        document.getElementById('reminder-time-input').addEventListener('change', function(e) {
            reminderTime = e.target.value;
            document.getElementById('reminder-time-value').textContent = reminderTime;
            localStorage.setItem('fitness-notifications', JSON.stringify({
                enabled: notificationsEnabled,
                reminderTime: reminderTime
            }));
            if (notificationsEnabled) {
                scheduleNotification(); // Reprogrammer avec la nouvelle heure
            }
        });

        // Chargement des objectifs et notifications depuis localStorage
        function loadSettings() {
            // Charger les objectifs
            const savedGoals = localStorage.getItem('fitness-goals');
            if (savedGoals) {
                dailyGoal = JSON.parse(savedGoals);
                document.getElementById('pushup-goal-slider').value = dailyGoal.pushups;
                document.getElementById('plank-goal-slider').value = dailyGoal.plank;
                document.getElementById('pushup-goal-value').textContent = dailyGoal.pushups;
                document.getElementById('plank-goal-value').textContent = formatTime(dailyGoal.plank);
                document.getElementById('goal-pushups').textContent = dailyGoal.pushups;
                document.getElementById('goal-plank').textContent = formatTime(dailyGoal.plank);
            }

            // Charger les param√®tres de notification
            const savedNotifications = localStorage.getItem('fitness-notifications');
            if (savedNotifications) {
                const notifSettings = JSON.parse(savedNotifications);
                notificationsEnabled = notifSettings.enabled;
                reminderTime = notifSettings.reminderTime || '18:00';
                document.getElementById('reminder-time-input').value = reminderTime;
                document.getElementById('reminder-time-value').textContent = reminderTime;
                updateNotificationUI();
                
                if (notificationsEnabled) {
                    scheduleNotification();
                }
            }

            // V√©rifier si l'utilisateur a d√©j√† refus√© les notifications
            const declined = localStorage.getItem('fitness-notifications-declined');
            if (!declined && !savedNotifications && 'Notification' in window) {
                // Attendre 3 secondes avant de proposer les notifications
                setTimeout(() => {
                    document.getElementById('notification-modal').classList.remove('hidden');
                }, 3000);
            }
        }

        // Initialisation de l'application
        async function initApp() {
            document.getElementById('loading').classList.remove('hidden');
            
            try {
                loadSettings();
                await loadWorkouts();
                updateDisplay();
                updateStats();
                
                // V√©rification quotidienne toutes les heures
                setInterval(checkDailyActivity, 3600000); // 1 heure
                
                // V√©rification imm√©diate
                setTimeout(checkDailyActivity, 5000);
                
            } catch (error) {
                console.error('Erreur d\'initialisation:', error);
                alert('Erreur de connexion √† Firebase. V√©rifiez votre configuration.');
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        }

        // Nettoyage avant fermeture
        window.addEventListener('beforeunload', function() {
            if (plankInterval) {
                clearInterval(plankInterval);
            }
        });

        // D√©marrage de l'application
        initApp();
    </script>
</body>
</html>
