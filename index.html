<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üí™ Pompes & Gainage</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-50">
    <div class="max-w-md mx-auto bg-gray-50 h-screen flex flex-col">
        <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4">
            <h1 class="text-xl font-bold text-center">üí™ Pompes & Gainage</h1>
            <p class="text-center text-blue-100 mt-1 text-sm">Votre coach personnel</p>
        </div>

        <div class="bg-white shadow-sm border-b">
            <div class="flex">
                <button onclick="setActiveTab('workout')" id="tab-workout" class="flex-1 py-3 px-2 text-center font-medium text-blue-600 border-b-2 border-blue-600 bg-blue-50">
                    <i class="fas fa-stopwatch text-sm mb-1 block"></i>
                    <span class="text-xs">Entra√Ænement</span>
                </button>
                <button onclick="setActiveTab('history')" id="tab-history" class="flex-1 py-3 px-2 text-center font-medium text-gray-500 hover:text-gray-700">
                    <i class="fas fa-calendar-alt text-sm mb-1 block"></i>
                    <span class="text-xs">Historique</span>
                </button>
                <button onclick="setActiveTab('stats')" id="tab-stats" class="flex-1 py-3 px-2 text-center font-medium text-gray-500 hover:text-gray-700">
                    <i class="fas fa-chart-line text-sm mb-1 block"></i>
                    <span class="text-xs">Stats</span>
                </button>
                <button onclick="setActiveTab('progression')" id="tab-progression" class="flex-1 py-3 px-2 text-center font-medium text-gray-500 hover:text-gray-700">
                    <i class="fas fa-trophy text-sm mb-1 block"></i>
                    <span class="text-xs">Progression</span>
                </button>
            </div>
        </div>

        <div class="flex-1 overflow-y-auto">
            <div id="workout-tab" class="tab-content p-3 space-y-3">
                <div class="bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg p-3 text-white">
                    <h2 class="text-sm font-bold mb-2">Aujourd'hui</h2>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <div id="today-pushups" class="text-lg font-bold">0</div>
                            <div class="text-xs opacity-90">Pompes (/<span id="goal-pushups">50</span>)</div>
                            <div class="w-full bg-white bg-opacity-30 rounded-full h-1.5 mt-1">
                                <div id="progress-pushups" class="bg-white h-1.5 rounded-full transition-all duration-500" style="width: 0%"></div>
                            </div>
                        </div>
                        <div>
                            <div id="today-plank" class="text-lg font-bold">0:00</div>
                            <div class="text-xs opacity-90">Gainage (/<span id="goal-plank">2:00</span>)</div>
                            <div class="w-full bg-white bg-opacity-30 rounded-full h-1.5 mt-1">
                                <div id="progress-plank" class="bg-white h-1.5 rounded-full transition-all duration-500" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg p-4 shadow">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-lg font-bold text-gray-800">üí™ Pompes</h3>
                        <div class="bg-blue-100 px-2 py-1 rounded-full">
                            <span id="pushup-badge" class="text-blue-600 font-semibold text-sm">0</span>
                        </div>
                    </div>
                    
                    <div class="text-center">
                        <div id="pushup-display" class="text-4xl font-bold text-blue-600 mb-3">0</div>
                        <div class="flex gap-2 justify-center">
                            <button onclick="decrementPushups()" id="pushup-minus" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-semibold transition-colors text-sm" disabled>
                                -1
                            </button>
                            <button onclick="incrementPushups()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg font-semibold transition-colors">
                                +1
                            </button>
                            <button onclick="addPushups(5)" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold transition-colors text-sm">
                                +5
                            </button>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg p-4 shadow">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-lg font-bold text-gray-800">‚è±Ô∏è Gainage</h3>
                        <div id="plank-status" class="px-2 py-1 rounded-full bg-gray-100">
                            <span class="font-semibold text-gray-600 text-xs">ARR√äT√â</span>
                        </div>
                    </div>
                    
                    <div class="text-center">
                        <div id="plank-display" class="text-4xl font-bold mb-3 text-gray-600">0:00</div>
                        <div class="flex gap-2 justify-center">
                            <button onclick="resetPlank()" class="bg-gray-500 hover:bg-gray-600 text-white p-2 rounded-lg transition-colors" title="Reset">
                                <i class="fas fa-redo text-sm"></i>
                            </button>
                            <button onclick="togglePlank()" id="plank-toggle" class="px-6 py-2 rounded-lg font-semibold flex items-center gap-2 transition-colors bg-green-500 hover:bg-green-600 text-white">
                                <i class="fas fa-play text-sm"></i>
                                START
                            </button>
                        </div>
                    </div>
                </div>

                <button onclick="saveWorkout()" id="save-btn" class="w-full bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white py-3 rounded-lg font-bold shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                    üíæ SAUVEGARDER LA S√âANCE
                </button>
            </div>

            <div id="history-tab" class="tab-content hidden p-3">
                <h2 class="text-xl font-bold text-gray-800 mb-3">üìà Historique</h2>
                <div id="workouts-list" class="space-y-2">
                    </div>
            </div>

            <div id="stats-tab" class="tab-content hidden p-3 space-y-4">
                <h2 class="text-xl font-bold text-gray-800 mb-3">üìä Statistiques</h2>
                
                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-gradient-to-br from-blue-500 to-blue-600 p-3 rounded-lg text-white">
                        <div id="total-pushups" class="text-xl font-bold">0</div>
                        <div class="text-xs opacity-90">Total pompes</div>
                    </div>
                    <div class="bg-gradient-to-br from-green-500 to-green-600 p-3 rounded-lg text-white">
                        <div id="total-plank" class="text-xl font-bold">0:00</div>
                        <div class="text-xs opacity-90">Total gainage</div>
                    </div>
                    <div class="bg-gradient-to-br from-purple-500 to-purple-600 p-3 rounded-lg text-white">
                        <div id="total-sessions" class="text-xl font-bold">0</div>
                        <div class="text-xs opacity-90">S√©ances</div>
                    </div>
                    <div class="bg-gradient-to-br from-pink-500 to-pink-600 p-3 rounded-lg text-white">
                        <div id="avg-pushups" class="text-xl font-bold">0</div>
                        <div class="text-xs opacity-90">Moy. pompes</div>
                    </div>
                </div>

                <h3 class="font-bold text-lg mb-2">Semaine</h3>
                <div id="stats-weekly" class="grid grid-cols-3 gap-3">
                    <div class="bg-blue-100 p-3 rounded-lg text-blue-800">
                        <div id="total-pushups-weekly" class="text-xl font-bold">0</div>
                        <div class="text-xs opacity-90">Pompes</div>
                    </div>
                    <div class="bg-green-100 p-3 rounded-lg text-green-800">
                        <div id="total-plank-weekly" class="text-xl font-bold">0:00</div>
                        <div class="text-xs opacity-90">Gainage</div>
                    </div>
                    <div class="bg-gray-100 p-3 rounded-lg text-gray-800">
                        <div id="total-sessions-weekly" class="text-xl font-bold">0</div>
                        <div class="text-xs opacity-90">S√©ances</div>
                    </div>
                </div>

                <h3 class="font-bold text-lg mb-2">Mois</h3>
                <div id="stats-monthly" class="grid grid-cols-3 gap-3">
                    <div class="bg-blue-100 p-3 rounded-lg text-blue-800">
                        <div id="total-pushups-monthly" class="text-xl font-bold">0</div>
                        <div class="text-xs opacity-90">Pompes</div>
                    </div>
                    <div class="bg-green-100 p-3 rounded-lg text-green-800">
                        <div id="total-plank-monthly" class="text-xl font-bold">0:00</div>
                        <div class="text-xs opacity-90">Gainage</div>
                    </div>
                    <div class="bg-gray-100 p-3 rounded-lg text-gray-800">
                        <div id="total-sessions-monthly" class="text-xl font-bold">0</div>
                        <div class="text-xs opacity-90">S√©ances</div>
                    </div>
                </div>

                <h3 class="font-bold text-lg mb-2">Ann√©e</h3>
                <div id="stats-yearly" class="grid grid-cols-3 gap-3">
                    <div class="bg-blue-100 p-3 rounded-lg text-blue-800">
                        <div id="total-pushups-yearly" class="text-xl font-bold">0</div>
                        <div class="text-xs opacity-90">Pompes</div>
                    </div>
                    <div class="bg-green-100 p-3 rounded-lg text-green-800">
                        <div id="total-plank-yearly" class="text-xl font-bold">0:00</div>
                        <div class="text-xs opacity-90">Gainage</div>
                    </div>
                    <div class="bg-gray-100 p-3 rounded-lg text-gray-800">
                        <div id="total-sessions-yearly" class="text-xl font-bold">0</div>
                        <div class="text-xs opacity-90">S√©ances</div>
                    </div>
                </div>

                <div class="bg-white p-4 rounded-lg shadow">
                    <h3 class="font-bold text-lg mb-3">üéØ Objectifs quotidiens</h3>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Pompes par jour: <span id="pushup-goal-value">50</span>
                            </label>
                            <input type="range" id="pushup-goal-slider" min="10" max="200" step="5" value="50" 
                                   class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Gainage par jour: <span id="plank-goal-value">2:00</span>
                            </label>
                            <input type="range" id="plank-goal-slider" min="30" max="600" step="15" value="120"
                                   class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        </div>
                    </div>
                </div>
            </div>

            <div id="progression-tab" class="tab-content hidden p-3 space-y-4">
                <h2 class="text-xl font-bold text-gray-800 mb-3">üìà √âvolution</h2>

                <div class="flex items-center space-x-2 mb-4">
                    <label for="progression-period-select" class="text-sm font-medium text-gray-700">P√©riode :</label>
                    <select id="progression-period-select" class="block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                        <option value="weekly">Par semaine</option>
                        <option value="monthly">Par mois</option>
                    </select>
                </div>

                <div class="bg-white rounded-lg p-4 shadow">
                    <table class="w-full text-left text-sm text-gray-600">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                            <tr>
                                <th scope="col" class="py-2 px-3">P√©riode</th>
                                <th scope="col" class="py-2 px-3">Pompes</th>
                                <th scope="col" class="py-2 px-3">Gainage</th>
                                <th scope="col" class="py-2 px-3">S√©ances</th>
                            </tr>
                        </thead>
                        <tbody id="progression-table-body">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div id="loading" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
        <div class="bg-white p-6 rounded-xl text-center">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"></div>
            <p>Connexion √† Firebase...</p>
        </div>
    </div>

    <script type="module">
        // Import Firebase modules
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Configuration Firebase - REMPLACEZ avec vos propres cl√©s
        const firebaseConfig = {
            apiKey: "AIzaSyD11MBNfS-eI4B4UR7b6gPtHo7zfN6CgME",
            authDomain: "fitness-app-b437f.firebaseapp.com",
            projectId: "fitness-app-b437f",
            storageBucket: "fitness-app-b437f.firebasestorage.app",
            messagingSenderId: "280277740696",
            appId: "1:280277740696:web:d3cedc8349cc71ee3174ed"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Variables globales
        let activeTab = 'workout';
        let pushupCount = 0;
        let plankTime = 0;
        let isPlankActive = false;
        let plankInterval = null;
        let workouts = [];
        let dailyGoal = { pushups: 50, plank: 120 };

        // Fonction pour formater le temps
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // Fonction pour obtenir la date du jour
        function getTodayDate() {
            return new Date().toISOString().split('T')[0];
        }

        // Fonction pour obtenir les stats du jour
        function getTodayStats() {
            const today = getTodayDate();
            const todayWorkouts = workouts.filter(w => w.date === today);
            const totalPushups = todayWorkouts.reduce((sum, w) => sum + w.pushups, 0) + pushupCount;
            const totalPlank = todayWorkouts.reduce((sum, w) => sum + w.plankTime, 0) + plankTime;
            return { totalPushups, totalPlank };
        }

        // Mise √† jour de l'affichage
        function updateDisplay() {
            // Mise √† jour du compteur de pompes
            document.getElementById('pushup-display').textContent = pushupCount;
            document.getElementById('pushup-badge').textContent = pushupCount;
            document.getElementById('pushup-minus').disabled = pushupCount === 0;

            // Mise √† jour du chrono gainage
            document.getElementById('plank-display').textContent = formatTime(plankTime);
            document.getElementById('plank-display').className = `text-4xl font-bold mb-3 ${isPlankActive ? 'text-green-600' : 'text-gray-600'}`;

            // Mise √† jour du statut du gainage
            const statusDiv = document.getElementById('plank-status');
            if (isPlankActive) {
                statusDiv.className = 'px-2 py-1 rounded-full bg-green-100';
                statusDiv.innerHTML = '<span class="font-semibold text-green-600 text-xs">EN COURS</span>';
            } else {
                statusDiv.className = 'px-2 py-1 rounded-full bg-gray-100';
                statusDiv.innerHTML = '<span class="font-semibold text-gray-600 text-xs">ARR√äT√â</span>';
            }

            // Mise √† jour du bouton plank
            const toggleBtn = document.getElementById('plank-toggle');
            if (isPlankActive) {
                toggleBtn.className = 'px-6 py-2 rounded-lg font-semibold flex items-center gap-2 transition-colors bg-red-500 hover:bg-red-600 text-white';
                toggleBtn.innerHTML = '<i class="fas fa-pause text-sm"></i> PAUSE';
            } else {
                toggleBtn.className = 'px-6 py-2 rounded-lg font-semibold flex items-center gap-2 transition-colors bg-green-500 hover:bg-green-600 text-white';
                toggleBtn.innerHTML = '<i class="fas fa-play text-sm"></i> START';
            }

            // Mise √† jour des stats du jour
            const { totalPushups, totalPlank } = getTodayStats();
            document.getElementById('today-pushups').textContent = totalPushups;
            document.getElementById('today-plank').textContent = formatTime(totalPlank);

            // Mise √† jour des barres de progression
            const pushupsProgress = Math.min(100, (totalPushups / dailyGoal.pushups) * 100);
            const plankProgress = Math.min(100, (totalPlank / dailyGoal.plank) * 100);
            document.getElementById('progress-pushups').style.width = `${pushupsProgress}%`;
            document.getElementById('progress-plank').style.width = `${plankProgress}%`;

            // Mise √† jour du bouton sauvegarder
            document.getElementById('save-btn').disabled = pushupCount === 0 && plankTime === 0;
        }

        // Fonction pour g√©rer les pompes
        window.incrementPushups = function() {
            pushupCount++;
            updateDisplay();
        };

        window.decrementPushups = function() {
            if (pushupCount > 0) {
                pushupCount--;
                updateDisplay();
            }
        };

        window.addPushups = function(amount) {
            pushupCount += amount;
            updateDisplay();
        };

        // Fonction pour g√©rer le gainage
        window.togglePlank = function() {
            if (isPlankActive) {
                clearInterval(plankInterval);
                plankInterval = null;
                isPlankActive = false;
            } else {
                plankInterval = setInterval(() => {
                    plankTime++;
                    updateDisplay();
                }, 1000);
                isPlankActive = true;
            }
            updateDisplay();
        };

        window.resetPlank = function() {
            plankTime = 0;
            isPlankActive = false;
            if (plankInterval) {
                clearInterval(plankInterval);
                plankInterval = null;
            }
            updateDisplay();
        };

        // Fonction pour sauvegarder une s√©ance
        window.saveWorkout = async function() {
            if (pushupCount === 0 && plankTime === 0) return;

            document.getElementById('loading').classList.remove('hidden');
            
            try {
                const newWorkout = {
                    date: getTodayDate(),
                    pushups: pushupCount,
                    plankTime: plankTime,
                    timestamp: new Date().toLocaleString('fr-FR'),
                    createdAt: new Date()
                };

                await addDoc(collection(db, 'workouts'), newWorkout);
                
                // Reset des valeurs
                pushupCount = 0;
                plankTime = 0;
                isPlankActive = false;
                
                if (plankInterval) {
                    clearInterval(plankInterval);
                    plankInterval = null;
                }
                
                await loadWorkouts();
                updateDisplay();
                updateStats();
                
                alert('S√©ance sauvegard√©e ! üéâ');
            } catch (error) {
                console.error('Erreur lors de la sauvegarde:', error);
                alert('Erreur lors de la sauvegarde. V√©rifiez votre configuration Firebase.');
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        };

        // Fonction pour charger les s√©ances
        async function loadWorkouts() {
            try {
                const q = query(collection(db, 'workouts'), orderBy('createdAt', 'desc'));
                const querySnapshot = await getDocs(q);
                workouts = [];
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    workouts.push({ id: doc.id, ...data, createdAt: data.createdAt.toDate() });
                });
                updateHistoryDisplay();
            } catch (error) {
                console.error('Erreur lors du chargement:', error);
                // Fallback sur le localStorage si Firebase √©choue
                const saved = localStorage.getItem('fitness-workouts');
                workouts = saved ? JSON.parse(saved) : [];
                updateHistoryDisplay();
            }
        }

        // Fonction pour supprimer une s√©ance
        window.deleteWorkout = async function(workoutId) {
            if (!confirm('√ätes-vous s√ªr de vouloir supprimer cette s√©ance ?')) return;
            
            document.getElementById('loading').classList.remove('hidden');
            
            try {
                await deleteDoc(doc(db, 'workouts', workoutId));
                await loadWorkouts();
                updateStats();
            } catch (error) {
                console.error('Erreur lors de la suppression:', error);
                alert('Erreur lors de la suppression');
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        };

        // Fonction pour mettre √† jour l'affichage de l'historique
        function updateHistoryDisplay() {
            const container = document.getElementById('workouts-list');
            
            if (workouts.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12 text-gray-500">
                        <i class="fas fa-bolt text-4xl mb-4 opacity-50"></i>
                        <p class="text-lg mb-2">Aucune s√©ance enregistr√©e</p>
                        <p class="text-sm">Commencez votre premier entra√Ænement !</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = workouts.slice(0, 10).map(workout => `
                <div class="bg-white p-3 rounded-lg shadow border">
                    <div class="flex justify-between items-start mb-2">
                        <div class="text-xs text-gray-500">${workout.timestamp}</div>
                        <button onclick="deleteWorkout('${workout.id}')" 
                                class="text-red-500 hover:text-red-700 hover:bg-red-50 p-1 rounded-full transition-colors"
                                title="Supprimer cette s√©ance">
                            <i class="fas fa-trash text-xs"></i>
                        </button>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="flex items-center gap-2">
                            <div class="w-2 h-2 bg-blue-500 rounded-full"></div>
                            <span class="font-semibold text-sm">${workout.pushups} pompes</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                            <span class="font-semibold text-sm">${formatTime(workout.plankTime)} gainage</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Fonction pour mettre √† jour les statistiques
        function updateStats() {
            // Stats g√©n√©rales (toutes p√©riodes confondues)
            const totalPushups = workouts.reduce((sum, w) => sum + w.pushups, 0);
            const totalPlankTime = workouts.reduce((sum, w) => sum + w.plankTime, 0);
            const avgPushups = workouts.length > 0 ? Math.round(totalPushups / workouts.length) : 0;

            document.getElementById('total-pushups').textContent = totalPushups;
            document.getElementById('total-plank').textContent = formatTime(totalPlankTime);
            document.getElementById('total-sessions').textContent = workouts.length;
            document.getElementById('avg-pushups').textContent = avgPushups;

            // Calcul des dates de d√©but pour chaque p√©riode
            const now = new Date();
            
            // Semaine
            const startOfWeek = new Date(now.getFullYear(), now.getMonth(), now.getDate() - (now.getDay() === 0 ? 6 : now.getDay() - 1));
            const workoutsWeekly = workouts.filter(w => new Date(w.createdAt) >= startOfWeek);
            const totalPushupsWeekly = workoutsWeekly.reduce((sum, w) => sum + w.pushups, 0);
            const totalPlankTimeWeekly = workoutsWeekly.reduce((sum, w) => sum + w.plankTime, 0);

            // Mois
            const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
            const workoutsMonthly = workouts.filter(w => new Date(w.createdAt) >= startOfMonth);
            const totalPushupsMonthly = workoutsMonthly.reduce((sum, w) => sum + w.pushups, 0);
            const totalPlankTimeMonthly = workoutsMonthly.reduce((sum, w) => sum + w.plankTime, 0);

            // Ann√©e
            const startOfYear = new Date(now.getFullYear(), 0, 1);
            const workoutsYearly = workouts.filter(w => new Date(w.createdAt) >= startOfYear);
            const totalPushupsYearly = workoutsYearly.reduce((sum, w) => sum + w.pushups, 0);
            const totalPlankTimeYearly = workoutsYearly.reduce((sum, w) => sum + w.plankTime, 0);

            // Mise √† jour de l'affichage des stats hebdomadaires
            document.getElementById('total-pushups-weekly').textContent = totalPushupsWeekly;
            document.getElementById('total-plank-weekly').textContent = formatTime(totalPlankTimeWeekly);
            document.getElementById('total-sessions-weekly').textContent = workoutsWeekly.length;
            
            // Mise √† jour de l'affichage des stats mensuelles
            document.getElementById('total-pushups-monthly').textContent = totalPushupsMonthly;
            document.getElementById('total-plank-monthly').textContent = formatTime(totalPlankTimeMonthly);
            document.getElementById('total-sessions-monthly').textContent = workoutsMonthly.length;
            
            // Mise √† jour de l'affichage des stats annuelles
            document.getElementById('total-pushups-yearly').textContent = totalPushupsYearly;
            document.getElementById('total-plank-yearly').textContent = formatTime(totalPlankTimeYearly);
            document.getElementById('total-sessions-yearly').textContent = workoutsYearly.length;
        }

        // Fonction pour afficher l'√©volution dans le nouvel onglet
        function updateProgressionDisplay(period) {
            const tableBody = document.getElementById('progression-table-body');
            tableBody.innerHTML = '';
            
            const groupedData = {};
            const now = new Date();

            workouts.forEach(workout => {
                const date = new Date(workout.createdAt);
                let periodKey;

                if (period === 'weekly') {
                    const startOfWeek = new Date(date.getFullYear(), date.getMonth(), date.getDate() - (date.getDay() === 0 ? 6 : date.getDay() - 1));
                    const weekNumber = Math.ceil((date - startOfWeek) / (7 * 24 * 60 * 60 * 1000));
                    periodKey = `${startOfWeek.toLocaleDateString('fr-FR')}`;
                } else { // monthly
                    periodKey = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}`;
                }
                
                if (!groupedData[periodKey]) {
                    groupedData[periodKey] = { pushups: 0, plankTime: 0, sessions: 0 };
                }
                groupedData[periodKey].pushups += workout.pushups;
                groupedData[periodKey].plankTime += workout.plankTime;
                groupedData[periodKey].sessions += 1;
            });
            
            const sortedKeys = Object.keys(groupedData).sort().reverse();
            
            sortedKeys.forEach(key => {
                const data = groupedData[key];
                const row = `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="py-2 px-3">${period === 'weekly' ? `Semaine du ${key}` : `${key}`}</td>
                        <td class="py-2 px-3">${data.pushups}</td>
                        <td class="py-2 px-3">${formatTime(data.plankTime)}</td>
                        <td class="py-2 px-3">${data.sessions}</td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });

            if (Object.keys(groupedData).length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="4" class="text-center py-4 text-gray-500">
                            Aucune donn√©e de progression pour cette p√©riode.
                        </td>
                    </tr>
                `;
            }
        }

        // Gestion des onglets
        window.setActiveTab = function(tab) {
            activeTab = tab;
            
            // Mise √† jour des boutons
            document.querySelectorAll('[id^="tab-"]').forEach(btn => {
                btn.className = 'flex-1 py-3 px-2 text-center font-medium text-gray-500 hover:text-gray-700';
            });
            document.getElementById(`tab-${tab}`).className = 'flex-1 py-3 px-2 text-center font-medium text-blue-600 border-b-2 border-blue-600 bg-blue-50';
            
            // Mise √† jour du contenu
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(`${tab}-tab`).classList.remove('hidden');

            if (tab === 'history') {
                updateHistoryDisplay();
            } else if (tab === 'stats') {
                updateStats();
            } else if (tab === 'progression') {
                updateProgressionDisplay(document.getElementById('progression-period-select').value);
            }
        };

        // √âv√©nement pour le s√©lecteur de p√©riode dans l'onglet Progression
        document.getElementById('progression-period-select').addEventListener('change', (event) => {
            updateProgressionDisplay(event.target.value);
        });

        // Gestion des objectifs
        document.getElementById('pushup-goal-slider').addEventListener('input', function(e) {
            dailyGoal.pushups = parseInt(e.target.value);
            document.getElementById('pushup-goal-value').textContent = dailyGoal.pushups;
            document.getElementById('goal-pushups').textContent = dailyGoal.pushups;
            updateDisplay();
            localStorage.setItem('fitness-goals', JSON.stringify(dailyGoal));
        });

        document.getElementById('plank-goal-slider').addEventListener('input', function(e) {
            dailyGoal.plank = parseInt(e.target.value);
            document.getElementById('plank-goal-value').textContent = formatTime(dailyGoal.plank);
            document.getElementById('goal-plank').textContent = formatTime(dailyGoal.plank);
            updateDisplay();
            localStorage.setItem('fitness-goals', JSON.stringify(dailyGoal));
        });

        // Chargement des objectifs depuis localStorage
        function loadGoals() {
            const saved = localStorage.getItem('fitness-goals');
            if (saved) {
                dailyGoal = JSON.parse(saved);
                document.getElementById('pushup-goal-slider').value = dailyGoal.pushups;
                document.getElementById('plank-goal-slider').value = dailyGoal.plank;
                document.getElementById('pushup-goal-value').textContent = dailyGoal.pushups;
                document.getElementById('plank-goal-value').textContent = formatTime(dailyGoal.plank);
                document.getElementById('goal-pushups').textContent = dailyGoal.pushups;
                document.getElementById('goal-plank').textContent = formatTime(dailyGoal.plank);
            }
        }

        // Initialisation de l'application
        async function initApp() {
            document.getElementById('loading').classList.remove('hidden');
            
            try {
                loadGoals();
                await loadWorkouts();
                updateDisplay();
                updateStats();
            } catch (error) {
                console.error('Erreur d\'initialisation:', error);
                alert('Erreur de connexion √† Firebase. V√©rifiez votre configuration.');
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        }

        // Nettoyage avant fermeture
        window.addEventListener('beforeunload', function() {
            if (plankInterval) {
                clearInterval(plankInterval);
            }
        });

        // D√©marrage de l'application
        initApp();
    </script>
</body>
</html>
